 <%@page import="com.hms.entity.Appointment"%>
<%@page import="java.util.List"%>
<%@page import="com.hms.entity.Doctor"%>
<%@page import="com.hms.dao.AppointmentDAO"%>
<%@page import="com.hms.db.DBConnection"%>
<%@page import="com.hms.dao.DoctorDAO"%>
<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>

<%@ taglib prefix="c" uri="jakarta.tags.core"%>
<%@page isELIgnored="false"%>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Patient List | Doctor</title>
  <%@include file="../component/allcss.jsp" %>
  <style>
    .my-card {
      border-radius: 14px;
      box-shadow: 0 8px 32px rgba(11,85,98,0.08);
      border: none;
      background: #fff;
    }
    .page-title {
      color: var(--primary);
      font-weight: 700;
      margin-bottom: 1rem;
    }
    .table {
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 8px 24px rgba(11,85,98,0.06);
    }
    .table thead th {
      background-color: var(--primary);
      color: #fff;
      border: none;
    }
    .table-striped > tbody > tr:nth-of-type(odd) {
      background-color: #f6f9fa;
    }
    .btn-sm {
      padding: 0.25rem 0.5rem;
      font-size: 0.825rem;
      border-radius: 10px;
    }
    .btn-success {
      background: var(--accent);
      border: none;
      font-weight: 600;
      transition: background 0.3s ease;
    }
    .btn-success:hover:not(.disabled) {
      background: #bd2f43;
      color: #fff;
    }
    .btn-success.disabled {
      opacity: 0.5;
      pointer-events: none;
    }
  </style>
</head>
<body>
 <%@ include file="../component/navbar.jsp" %>


  <c:if test="${empty doctorObj}">
    <c:redirect url="../doctor_login.jsp" />
  </c:if>

  <div class="container py-4">
    <h2 class="page-title text-center">Patient Details</h2>

    <c:if test="${not empty successMsg}">
      <div class="alert alert-success text-center">${successMsg}</div>
      <c:remove var="successMsg" scope="session" />
    </c:if>
    <c:if test="${not empty errorMsg}">
      <div class="alert alert-danger text-center">${errorMsg}</div>
      <c:remove var="errorMsg" scope="session" />
    </c:if>

    <div class="card my-card p-3">
      <table class="table table-striped table-hover align-middle">
        <thead>
          <tr>
            <th scope="col" style="min-width: 120px;">Full Name</th>
            <th scope="col">Gender</th>
            <th scope="col">Age</th>
            <th scope="col">Appointment Date</th>
            <th scope="col">Email</th>
            <th scope="col">Phone</th>
            <th scope="col">Diseases</th>
            <th scope="col">Status</th>
            <th scope="col" style="min-width: 150px;">Action</th>
          </tr>
        </thead>
        <tbody>
          <%
            Doctor doctor = (Doctor) session.getAttribute("doctorObj");
            AppointmentDAO appDAO = new AppointmentDAO(DBConnection.getConn());
            List<Appointment> list = appDAO.getAllAppointmentByLoginDoctor(doctor.getId());
            for (Appointment applist : list) {
          %>
          <tr>
            <td><%= applist.getFullName() %></td>
            <td><%= applist.getGender() %></td>
            <td><%= applist.getAge() %></td>
            <td><%= applist.getAppointmentDate() %></td>
            <td><%= applist.getEmail() %></td>
            <td><%= applist.getPhone() %></td>
            <td><%= applist.getDiseases() %></td>
            <td><%= applist.getStatus() %></td>
            <td>
              <%
                if ("Pending".equals(applist.getStatus())) {
              %>
              <a href="comment.jsp?id=<%= applist.getId() %>" 
                 class="btn btn-success btn-sm">Comment / Prescription</a>
              <%
                } else {
              %>
              <a href="#!" class="btn btn-success btn-sm disabled" tabindex="-1" aria-disabled="true">
                <i class="fa fa-comment"></i> Comment / Prescription
              </a>
              <%
                }
              %>
            </td>
          </tr>
          <% } %>
        </tbody>
      </table>
    </div>
  </div>
</body>
</html>
 