<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="jakarta.tags.core"%>
<%@page isELIgnored="false"%>

<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>User Login</title>
<%@include file="component/allcss.jsp"%>

<style>
/* ======== Responsive Glass Background ======== */
.login-bg {
  position: relative;
  width: 100%;
  min-height: 100vh;
  background: url('img/doc6.png') top center / cover no-repeat;
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
}

.login-bg::before {
  content: "";
  position: absolute;
  inset: 0;
  background: rgba(255, 255, 255, 0.35);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  z-index: 1;
}

/* ======== Card ======== */
.login-card {
  position: relative;
  z-index: 2;
  background: rgba(255, 255, 255, 0.88);
  border-radius: 1.2rem;
  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  padding: 2.5rem;
  width: 90%;
  max-width: 420px;
  transition: all 0.3s ease;
  animation: fadeInUp 0.7s ease;
}

.login-card:hover {
  transform: translateY(-3px);
  box-shadow: 0 15px 45px rgba(0, 0, 0, 0.25);
}

/* ======== Typography ======== */
.login-card h3 {
  font-weight: 700;
  color: var(--primary-color, #4568dc);
}

/* ======== Buttons ======== */
.btn.my-bg-color {
  background: linear-gradient(135deg, #4568dc, #3b5bb3);
  border: none;
  font-weight: 500;
  transition: all 0.25s ease-in-out;
}
.btn.my-bg-color:hover {
  background: linear-gradient(135deg, #3a57b3, #2f4fa0);
  transform: translateY(-2px);
}

/* ======== Responsive Design ======== */
@media (max-width: 992px) {
  .login-card {
    padding: 2rem;
    max-width: 400px;
  }
}
@media (max-width: 768px) {
  .login-bg {
    background-position: top 10% center;
  }
  .login-card {
    width: 95%;
    padding: 1.8rem;
    border-radius: 1rem;
  }
}
@media (max-width: 480px) {
  .login-bg {
    background-position: top 15% center;
  }
  .login-card {
    padding: 1.5rem;
  }
}

/* Fade Animation */
@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}
</style>

<!-- âœ… Validation Script (unchanged backend logic) -->
<script>
  function validateEmail() {
    const emailInput = document.getElementById("email");
    const emailError = document.getElementById("emailError");
    const emailPattern = /^(?!.*\.\.)[a-zA-Z0-9._%+-]{2,64}@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;

    const emailValue = emailInput.value.trim();
    emailError.textContent = "";
    emailInput.classList.remove("is-invalid", "is-valid");

    if (emailValue === "") {
      emailError.textContent = "Email address is required.";
      emailInput.classList.add("is-invalid");
      return false;
    }

    if (!emailPattern.test(emailValue)) {
      emailError.textContent = "Please enter a valid email address (e.g., user@example.com)";
      emailInput.classList.add("is-invalid");
      return false;
    }

    emailInput.classList.add("is-valid");
    return true;
  }

  function validatePassword() {
    const passwordInput = document.getElementById("password");
    const passwordError = document.getElementById("passwordError");
    const passwordValue = passwordInput.value.trim();
    const passwordPattern = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/;

    passwordError.textContent = "";
    passwordInput.classList.remove("is-invalid", "is-valid");

    if (passwordValue === "") {
      passwordError.textContent = "Password is required.";
      passwordInput.classList.add("is-invalid");
      return false;
    }

    if (!passwordPattern.test(passwordValue)) {
      passwordError.textContent = "Password must be at least 8 characters and include uppercase, lowercase, number, and special character.";
      passwordInput.classList.add("is-invalid");
      return false;
    }

    passwordInput.classList.add("is-valid");
    return true;
  }

  document.addEventListener("DOMContentLoaded", function() {
    const form = document.querySelector("form");
    const emailField = document.getElementById("email");
    const passwordField = document.getElementById("password");

    if (emailField) emailField.addEventListener("input", validateEmail);
    if (passwordField) passwordField.addEventListener("input", validatePassword);

    if (form) {
      form.addEventListener("submit", function(e) {
        if (!validateEmail() || !validatePassword()) {
          e.preventDefault();
        }
      });
    }
  });
</script>
</head>

<body>
  <!-- Navbar -->
  <%@include file="component/navbar.jsp"%>

  <!-- Login Section -->
  <div class="login-bg">
    <div class="card login-card">
      <div class="card-body">
        <h3 class="text-center mb-4"><i class="fa fa-group me-2"></i>User Login</h3>

        <!-- Success/Error Message -->
        <c:if test="${not empty successMsg}">
          <div class="alert alert-success text-center">${successMsg}</div>
          <c:remove var="successMsg" scope="session" />
        </c:if>
        <c:if test="${not empty errorMsg}">
          <div class="alert alert-danger text-center">${errorMsg}</div>
          <c:remove var="errorMsg" scope="session" />
        </c:if>

        <!-- Login Form -->
        <form action="userLogin" method="post">
          <div class="mb-3">
            <label class="form-label">Email address</label>
            <input required id="email" name="email" type="email"
              placeholder="Enter Email" class="form-control" maxlength="75"
              title="Please enter a valid email address (e.g., user@example.com)">
            <div id="emailHelp" class="form-text">We'll never share your email with anyone else.</div>
            <div id="emailError" class="text-danger mt-1" style="font-size: 0.9em;"></div>
          </div>

          <div class="mb-3">
            <label class="form-label">Password</label>
            <input required id="password" name="password" type="password"
              placeholder="Enter password" class="form-control" minlength="8">
            <div id="passwordError" class="text-danger mt-1" style="font-size: 0.9em;"></div>
          </div>

          <button type="submit" class="btn my-bg-color text-white w-100 mt-3">Login</button>
        </form>

        <div class="text-center mt-3">
          <small>Don't have an account? <a href="signup.jsp" class="text-decoration-none myP-color">Create one</a></small>
        </div>
      </div>
    </div>
  </div>
</body>
</html>
