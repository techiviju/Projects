<%@page import="com.hms.entity.Doctor"%>
<%@page import="com.hms.dao.DoctorDAO"%>
<%@page import="com.hms.entity.User"%>
<%@page import="com.hms.entity.Appointment"%>
<%@page import="java.util.List"%>
<%@page import="com.hms.db.DBConnection"%>
<%@page import="com.hms.dao.AppointmentDAO"%>
<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>

<%@ taglib prefix="c" uri="jakarta.tags.core"%>
<%@page isELIgnored="false"%>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>View Appointment</title>
<%@include file="../component/allcss.jsp" %>

<style>
  .my-card {
    border-radius: 14px;
    box-shadow: 0px 0px 14px rgba(128, 0, 0, 0.3);
    background: #fff;
    border: none;
  }
  .my-bg-img {
    background: linear-gradient(rgba(0,0,0,0.4), rgba(0,0,0,0.4)), url("img/hospital1.jpg");
    height: 20vh;
    background-size: cover;
    background-repeat: no-repeat;
    border-radius: 14px;
    box-shadow: 0 4px 28px rgba(0,0,0,0.12);
    margin-bottom: 2rem;
  }
  .my-bg-color {
    background-color: #0b5562;
    color: white;
  }
  .table thead th {
    background-color: #0b5562;
    color: white;
    border: none;
  }
  .page-title {
    color: #0b5562;
    font-weight: 700;
    margin-bottom: 2rem;
  }
</style>
</head>
<body>

<%@include file="component/navbar.jsp" %>

<c:if test="${empty userObj}">
  <c:redirect url="/user_login.jsp" />
</c:if>

<div class="container-fluid my-bg-img d-flex justify-content-center align-items-center">
  <p class="text-white fs-2 mb-0">Your Appointments</p>
</div>

<div class="container">
  <div class="row">
    <div class="col-md-9">
      <div class="card my-card p-4 shadow-sm">
        <p class="page-title text-center">Appointment List</p>

        <table class="table table-striped table-hover align-middle">
          <thead>
            <tr>
              <th>Full Name</th>
              <th>Gender</th>
              <th>Age</th>
              <th>Appointment Date</th>
              <th>Phone</th>
              <th>Diseases</th>
              <th>Doctor Name</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            <%
              User user = (User) session.getAttribute("userObj");
              DoctorDAO dDAO = new DoctorDAO(DBConnection.getConn());
              AppointmentDAO appDAO = new AppointmentDAO(DBConnection.getConn());
              List<Appointment> list = appDAO.getAllAppointmentByLoginUser(user.getId());
              for (Appointment apptList : list) {
                Doctor doctor = dDAO.getDoctorById(apptList.getDoctorId());
            %>
            <tr>
              <td><%= apptList.getFullName() %></td>
              <td><%= apptList.getGender() %></td>
              <td><%= apptList.getAge() %></td>
              <td><%= apptList.getAppointmentDate() %></td>
              <td><%= apptList.getPhone() %></td>
              <td><%= apptList.getDiseases() %></td>
              <td><%= doctor.getFullName() %></td>
              <td>
                <%
                  if ("Pending".equals(apptList.getStatus())) {
                %>
                  <a href="#" class="btn btn-sm btn-warning disabled" tabindex="-1" aria-disabled="true">Pending</a>
                <%
                  } else {
                %>
                  <%= apptList.getStatus() %>
                <%
                  }
                %>
              </td>
            </tr>
            <%
              }
            %>
          </tbody>
        </table>
      </div>
    </div>

    <div class="col-md-3">
      <img src="img/wdoc.jpg" alt="Doctor" class="img-fluid rounded shadow-sm" />
    </div>
  </div>
</div>

</body>
</html>
